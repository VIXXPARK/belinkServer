language: node_js
node_js:
  - 12

sudo: true

services:
  - mysql

branches:
  only:
    - main

cache:
  directories:
    - node_modules

env:
  - NODE_ENV=test

install:
  - npm install -g
  - npm install mocha chai chai-http express jsonwebtoken sequelize mysql2 dotenv


before_scripts:
  - wget https://repo.mysql.com//mysql-apt-config_0.8.10-1_all.deb
  - sudo dpkg -i mysql-apt-config_0.8.10-1_all.deb
  - sudo apt-get update -q
  - sudo apt-get install -q -y --allow-unauthenticated -o Dpkg::Options::=--force-confnew mysql-server
  - sudo systemctl restart mysql
  - sudo mysql_upgrade
  - mysql --version  
  - sudo mysql -u root -e 'create user belink;'
  - sudo mysql -u root -e "create user 'belink'@'localhost' identified by '0000';"
  - sudo mysql -u root -e "create database belink_test default character set utf8;"
  - sudo mysql -u root -e "grant all privileges on belink_test.* to 'belink'@'localhost';"
  - sudo mysql -u root -e "flush privileges;"

script:
  - npm test
